;;; про-код-на-rust.el --- Поддержка Rust в Emacs -*- lexical-binding: t; -*-
;;
;; Автор: Пётр <11111000000@email.com>
;; Версия: 1.0
;; Keywords: rust, rustic, cargo, nix
;; URL: https://example.com/про-код-на-rust
;;
;;; Commentary:
;;
;; Этот файл настраивает поддержку Rust в Emacs, следуя принципам литературного
;; программирования: код представлен как повествование, где каждая
;; секция мотивируется, объясняется и логически связывается с остальными. Мы
;; стремимся к элегантности, минимализму и производительности в лучших традициях
;; Emacs — с использованием `use-package` для декларативной конфигурации и отложенной
;; загрузки для скорости.
;;
;; Почему это важно? Rust — современный язык с фокусом на безопасности и производительности.
;; Здесь мы интегрируем rust-mode для базовой подсветки и rustic как полноценную
;; IDE-поддержку (с Cargo, REPL, LSP), добавляя Nix для изолированных окружений.
;;
;; Структура файла:
;; 0. Введение и зависимости: Базовые require (если нужны).
;; 1. Rust-mode: Базовый режим.
;; 2. Rustic: Полноценная поддержка с Nix-интеграцией.
;; 3. Финал: Provide и ends here.
;;
;; Использование: Загружайте через (require 'про-код-на-rust) в вашем init.el.
;; Рекомендуется с Eglot для LSP.
;;
;; Замечания: Отложенная загрузка (:defer t) минимизирует стартовое время.

;;; Code:

;;;; 1. Rust-mode
;; Rust-mode предоставляет базовую подсветку синтаксиса и индентацию для .rs-файлов.
;; Мы загружаем его отложенно, чтобы не нагружать запуск.

(use-package rust-mode
  :defer t
  :ensure t)

;;;; 2. Rustic
;; Rustic расширяет rust-mode до полноценной среды: интеграция с Cargo, REPL,
;; форматированием и LSP. Мы добавляем Nix-поддержку для запуска через nix-shell
;; в проектах с shell.nix, обеспечивая воспроизводимость окружения.

(use-package rustic
  :defer t
  :ensure t
  :config
  ;; Поддержка Nix: использовать nix-shell для cargo, если shell.nix существует.
  (when (and (executable-find "nix-shell") (file-exists-p "shell.nix"))
    (setq rustic-cargo-wrapper-function
          (lambda (cmd) (list "nix-shell" "--run" cmd)))))

(provide 'про-код-на-rust)
;;; про-код-на-rust.el ends here
